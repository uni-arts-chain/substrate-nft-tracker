#!/usr/bin/env ruby

require File.expand_path("../lib/tracker", __dir__)

Tracker::logger = Logger.new(STDOUT)
Tracker::logger.level = Logger::INFO

if ARGV[0].nil? 
  puts "Please input a block_number."
  puts "Usage: pangolin <BLOCK_NUMBER>"
else
  begin
    start_from = Integer(ARGV[0])

    # init client and nft helper
    pangolin = Pangolin.new("wss://pangolin-rpc.darwinia.network")
    nft_helper = SubstrateEvmNftHelper.new(pangolin)

    nft_helper.track_nft(start_from) do |erc721_events, erc1155_events|
      # TODO: send to sidekiq queue
    end

  rescue ArgumentError => ex
    if ex.message.start_with?("invalid value for Integer")
      puts "Please input an integer as the block number."
      puts "Usage: pangolin <BLOCK_NUMBER>"
    end
  end
end

